#include "script_component.hpp"

if (!isServer) exitWith {};

params ["_carrier", "_side"];

private _carriers = GVAR(Game) getVariable QGVAR(carriers);
_carriers set [_side, _carrier];
GVAR(Game) setVariable [QGVAR(carriers), _carriers, true];

private _data = createHashMapFromArray [
    ["side", sideUnknown],
    ["max_hp", [QGVAR(Settings_CarrierMaxHP)] call CBA_settings_fnc_get],
    ["current_hp", [QGVAR(Settings_CarrierMaxHP)] call CBA_settings_fnc_get],

    ["speaker_positions", []],
    ["endGameCameraPosition", []],

    ["composition", createHashMapFromArray [
        ["explosion_posAGL", [
            [17.4858,174.711,8.99108],
            [17.8994,165.726,4.66877],
            [18.853,152.843,6.97879],
            [19.4404,142.383,3.32789],
            [20.9341,114.638,16.7793],
            [20.0659,131.099,11.9188],
            [32.5591,99.4014,16.1134],
            [26.5273,87.4688,10.1991],
            [34.0718,68.2568,17.6108],
            [29.0483,54.0273,12.7268],
            [33.208,37.0542,16.7902],
            [26.2505,42.8672,9.98759],
            [32.5547,26.7241,16.1512],
            [26.2031,23.416,9.94163],
            [32.0454,15.2085,15.6529],
            [27.0112,4.36279,10.782],
            [32.354,-0.962891,16.0054],
            [33.0786,-18.6548,16.7132],
            [26.8257,-28.5527,10.6001],
            [32.4126,-36.6982,16.0622],
            [31.9023,-46.5957,15.5419],
            [25.9453,-58.812,9.66558],
            [30.5757,-73.6777,16.6179],
            [21.6992,-89.2734,14.6704],
            [20.667,-84.9551,5.31924],
            [20.7754,-103.713,15.3696],
            [14.9487,-116.726,5.03314],
            [16.5059,-134.777,15.5754],
            [7.10986,-156.271,8.91541],
            [-5.60693,-159.744,6.85403],
            [-13.2788,-149.726,14.7547],
            [-12.25,-131.813,7.57448],
            [-16.2388,-115.739,8.09432],
            [-20.8525,-101.877,13.3469],
            [-22.0728,-87.6157,16.0717],
            [-29.3145,-73.7236,16.3148],
            [-21.7373,-50.6787,3.18176],
            [-20.7651,-88.5225,7.63222],
            [-17.6602,-131.397,16.6237],
            [-21.3379,-72.8828,5.39927],
            [-30.6343,-61.7427,14.5117],
            [-20.5791,-39.1445,13.6596],
            [-24.3877,-43.6265,18.593],
            [-21.9111,-16.834,15.5137],
            [-21.897,-4.72656,17.1412],
            [-31.1484,6.63818,15.973],
            [-25.2178,21.2764,9.43631],
            [-36.2749,17.2378,19.277],
            [-21.9463,43.2993,9.52294],
            [-21.9834,64.5854,15.7584],
            [-21.9727,50.4204,14.1053],
            [-28.7197,14.2051,13.5037],
            [-34.5918,30.4492,17.2262],
            [-21.915,82.8682,11.6146],
            [-21.9297,49.4126,2.41698],
            [-21.9209,24.3745,3.53044],
            [-28.0479,93.8843,11.8217],
            [-22.2031,111.351,6.4133],
            [-34.3364,105.749,16.3575],
            [-29.4834,126.212,13.1549],
            [-34.6123,114.582,16.9764],
            [-19.9063,133.305,4.1053],
            [-31.2925,143.378,15.3517],
            [-33.9351,131.992,17.0893],
            [-30.9902,153.881,15.4832],
            [-19.0518,161.299,4.8993],
            [-34.0801,182.382,16.953],
            [-23.7197,183.037,17.448],
            [-42.1167,172.307,15.0319],
            [-19.2729,191.541,10.5722],
            [7.73145,176.962,12.3986],
            [12.0664,184.326,15.7622],
            [27.3965,181.391,16.4451],
            [-8.33691,178.055,12.4695]
        ]]
    ]]
];
{
    _carrier setVariable [format[QGVAR(%1),_x], _y, true];
} forEach _data;

_carrier setVariable [QGVAR(side), _side, true];

// Ramps
private _pos = getPosASL _carrier;
private _ramps = _pos nearObjects ["Land_Obstacle_Ramp_F", 300];
_ramps apply {
    private _class = typeOf _x;
    private _vectorDirAndUp = [vectorDir _x, vectorUp _x];
    private _pos = getPosASL _x;

    deleteVehicle _x;
    private _newRamp = createSimpleObject [_class, _pos, false];
    _newRamp setVectorDirAndUp _vectorDirAndUp;
    _newRamp setObjectScale 3;
};